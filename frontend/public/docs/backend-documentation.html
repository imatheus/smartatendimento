<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Atendimento - Backend Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="backend-styles.css">
</head>
<body>
    <div class="container">
        <div class="layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h1>Smart Atendimento</h1>
                    <p>Backend Documentation</p>
                </div>

                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="#overview" class="nav-link active" data-section="overview"><i class="fas fa-home"></i> Vis√£o Geral</a></li>
                        <li><a href="#architecture" class="nav-link" data-section="architecture"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
                        <li><a href="#features" class="nav-link" data-section="features"><i class="fas fa-cogs"></i> Funcionalidades</a></li>
                        <li><a href="#models" class="nav-link" data-section="models"><i class="fas fa-database"></i> Modelos</a></li>
                        <li><a href="#apis" class="nav-link" data-section="apis"><i class="fas fa-plug"></i> APIs</a></li>
                        <li><a href="#ai-agent" class="nav-link" data-section="ai-agent"><i class="fas fa-robot"></i> Agente de IA</a></li>
                        <li><a href="#treinamento" class="nav-link" data-section="treinamento"><i class="fas fa-graduation-cap"></i> Treinamento</a></li>
                        <li><a href="#config" class="nav-link" data-section="config"><i class="fas fa-cog"></i> Configura√ß√£o</a></li>
                    </ul>
                </nav>

                <div class="quick-links">
                    <h3><i class="fas fa-bolt"></i> Links R√°pidos</h3>
                    <ul>
                        <li><a href="#" onclick="scrollToSection('whatsapp-integration')"><i class="fab fa-whatsapp"></i> WhatsApp</a></li>
                        <li><a href="#" onclick="scrollToSection('ticket-system')"><i class="fas fa-ticket-alt"></i> Tickets</a></li>
                        <li><a href="#" onclick="scrollToSection('multi-tenant')"><i class="fas fa-building"></i> Multi-Tenant</a></li>
                        <li><a href="#" onclick="scrollToSection('campaigns')"><i class="fas fa-bullhorn"></i> Campanhas</a></li>
                        <li><a href="#" onclick="scrollToSection('ai-agent')"><i class="fas fa-robot"></i> Agente IA</a></li>
                        <li><a href="#" onclick="scrollToSection('treinamento')"><i class="fas fa-graduation-cap"></i> Treinamento</a></li>
                    </ul>
                </div>

                <div class="docs-links">
                    <h3><i class="fas fa-book"></i> Documentos</h3>
                    <ul>
                        <li><a href="#" onclick="loadMarkdownContent('architecture', 'Arquitetura')"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
                        <li><a href="#" onclick="loadMarkdownContent('dependencies', 'Depend√™ncias')"><i class="fas fa-cube"></i> Depend√™ncias</a></li>
                        <li><a href="#" onclick="loadMarkdownContent('api', 'API Reference')"><i class="fas fa-plug"></i> API Reference</a></li>
                        <li><a href="#" onclick="loadMarkdownContent('development', 'Dev Guide')"><i class="fas fa-code"></i> Dev Guide</a></li>
                        <li><a href="#" onclick="loadMarkdownContent('troubleshooting', 'Troubleshooting')"><i class="fas fa-wrench"></i> Troubleshooting</a></li>
                    </ul>
                </div>
            </aside>

            <main class="main">
            <section id="overview" class="section active">
                <h2>Vis√£o Geral</h2>
                <div class="content">
                    <p>Sistema de atendimento multi-tenant com integra√ß√£o WhatsApp, desenvolvido em Node.js/TypeScript.</p>
                    
                    <h3>Stack Principal</h3>
                    <ul>
                        <li><strong>Runtime:</strong> Node.js + TypeScript</li>
                        <li><strong>Framework:</strong> Express.js</li>
                        <li><strong>ORM:</strong> Sequelize</li>
                        <li><strong>Banco:</strong> PostgreSQL</li>
                        <li><strong>WebSocket:</strong> Socket.IO</li>
                        <li><strong>Filas:</strong> Bull + Redis</li>
                        <li><strong>WhatsApp:</strong> @whiskeysockets/baileys</li>
                    </ul>

                    <h3>Estrutura de Pastas</h3>
                    <pre><code>backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # Controladores das rotas
‚îÇ   ‚îú‚îÄ‚îÄ models/         # Modelos Sequelize
‚îÇ   ‚îú‚îÄ‚îÄ services/       # L√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ routes/         # Defini√ß√£o das rotas
‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # Middlewares customizados
‚îÇ   ‚îú‚îÄ‚îÄ database/       # Migrations e seeders
‚îÇ   ‚îú‚îÄ‚îÄ libs/          # Bibliotecas customizadas
‚îÇ   ‚îú‚îÄ‚îÄ helpers/       # Fun√ß√µes auxiliares
‚îÇ   ‚îî‚îÄ‚îÄ utils/         # Utilit√°rios
‚îú‚îÄ‚îÄ uploads/           # Arquivos enviados
‚îî‚îÄ‚îÄ public/           # Arquivos est√°ticos</code></pre>
                </div>
            </section>

            <section id="architecture" class="section">
                <h2>Arquitetura</h2>
                <div class="content">
                    <h3>Camadas da Aplica√ß√£o</h3>
                    <div class="layer">
                        <h4>1. Rotas (Routes)</h4>
                        <p><code>src/routes/</code> - Defini√ß√£o dos endpoints da API</p>
                    </div>
                    <div class="layer">
                        <h4>2. Controladores (Controllers)</h4>
                        <p><code>src/controllers/</code> - L√≥gica de controle das requisi√ß√µes</p>
                    </div>
                    <div class="layer">
                        <h4>3. Servi√ßos (Services)</h4>
                        <p><code>src/services/</code> - Regras de neg√≥cio e integra√ß√µes</p>
                    </div>
                    <div class="layer">
                        <h4>4. Modelos (Models)</h4>
                        <p><code>src/models/</code> - Defini√ß√£o das entidades do banco</p>
                    </div>

                    <h3>Integra√ß√µes Principais</h3>
                    <ul>
                        <li><strong>WhatsApp:</strong> <code>src/libs/wbot.ts</code></li>
                        <li><strong>Socket.IO:</strong> <code>src/libs/socket.ts</code></li>
                        <li><strong>Filas:</strong> <code>src/libs/Queue.ts</code></li>
                        <li><strong>Database:</strong> <code>src/database/</code></li>
                    </ul>
                </div>
            </section>

            <section id="features" class="section">
                <h2>Funcionalidades</h2>
                <div class="content">
                    <div class="feature-group" id="multi-tenant">
                        <h3>Sistema Multi-Tenant</h3>
                        <p><strong>Onde alterar:</strong> <code>src/models/Company.ts</code>, <code>src/middleware/CheckAuth.ts</code></p>
                        <ul>
                            <li>Isolamento por empresa</li>
                            <li>Planos de assinatura</li>
                            <li>Limites configur√°veis</li>
                        </ul>
                    </div>

                    <div class="feature-group" id="whatsapp-integration">
                        <h3>WhatsApp Integration</h3>
                        <p><strong>Onde alterar:</strong> <code>src/services/WbotServices/</code>, <code>src/libs/wbot.ts</code></p>
                        <ul>
                            <li>M√∫ltiplas conex√µes</li>
                            <li>Gerenciamento de sess√µes</li>
                            <li>Envio de m√≠dia</li>
                        </ul>
                    </div>

                    <div class="feature-group" id="ticket-system">
                        <h3>Sistema de Tickets</h3>
                        <p><strong>Onde alterar:</strong> <code>src/services/TicketServices/</code>, <code>src/models/Ticket.ts</code></p>
                        <ul>
                            <li>Cria√ß√£o autom√°tica</li>
                            <li>Estados (pendente/aberto/fechado)</li>
                            <li>Atribui√ß√£o de atendentes</li>
                        </ul>
                    </div>

                    <div class="feature-group">
                        <h3>Chatbot</h3>
                        <p><strong>Onde alterar:</strong> <code>src/services/WbotServices/wbotMessageListener.ts</code></p>
                        <ul>
                            <li>Op√ß√µes autom√°ticas</li>
                            <li>Fluxo de conversa√ß√£o</li>
                            <li>Integra√ß√£o com tickets</li>
                        </ul>
                    </div>

                    <div class="feature-group" id="campaigns">
                        <h3>Campanhas</h3>
                        <p><strong>Onde alterar:</strong> <code>src/services/CampaignServices/</code>, <code>src/jobs/</code></p>
                        <ul>
                            <li>Envio em massa</li>
                            <li>Agendamento</li>
                            <li>Processamento em filas</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="models" class="section">
                <h2>Modelos de Dados</h2>
                <div class="content">
                    <div class="model-grid">
                        <div class="model-item">
                            <h4>Company</h4>
                            <p>Empresas do sistema</p>
                            <code>src/models/Company.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>User</h4>
                            <p>Usu√°rios/atendentes</p>
                            <code>src/models/User.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Contact</h4>
                            <p>Contatos/clientes</p>
                            <code>src/models/Contact.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Ticket</h4>
                            <p>Tickets de atendimento</p>
                            <code>src/models/Ticket.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Message</h4>
                            <p>Mensagens trocadas</p>
                            <code>src/models/Message.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Whatsapp</h4>
                            <p>Conex√µes WhatsApp</p>
                            <code>src/models/Whatsapp.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Queue</h4>
                            <p>Filas de atendimento</p>
                            <code>src/models/Queue.ts</code>
                        </div>
                        <div class="model-item">
                            <h4>Campaign</h4>
                            <p>Campanhas de marketing</p>
                            <code>src/models/Campaign.ts</code>
                        </div>
                    </div>

                    <!-- Aba: Treinamento -->
                    <div class="ai-tab-content" id="training">
                        <h3>Sistema de Treinamento da IA com Embeddings e Similaridade</h3>
                        
                        <div class="training-overview">
                            <h4>Vis√£o Geral do Treinamento</h4>
                            <p>O PEPE ser√° treinado usando uma combina√ß√£o de embeddings vetoriais e an√°lise de similaridade para fornecer respostas contextuais e precisas baseadas no conhecimento espec√≠fico de cada empresa.</p>
                        </div>

                        <div class="embedding-system">
                            <h4>Sistema de Embeddings</h4>
                            
                            <div class="embedding-process">
                                <h5>Como Funciona</h5>
                                <div class="process-steps">
                                    <div class="step">
                                        <span class="step-number">1</span>
                                        <div class="step-content">
                                            <h6>Coleta de Dados</h6>
                                            <p>Extra√ß√£o de informa√ß√µes da empresa: site, documentos, FAQs, hist√≥rico de conversas</p>
                                        </div>
                                    </div>
                                    <div class="step">
                                        <span class="step-number">2</span>
                                        <div class="step-content">
                                            <h6>Processamento de Texto</h6>
                                            <p>Segmenta√ß√£o em chunks, limpeza e normaliza√ß√£o dos dados</p>
                                        </div>
                                    </div>
                                    <div class="step">
                                        <span class="step-number">3</span>
                                        <div class="step-content">
                                            <h6>Gera√ß√£o de Embeddings</h6>
                                            <p>Convers√£o de texto em vetores usando modelos de embedding</p>
                                        </div>
                                    </div>
                                    <div class="step">
                                        <span class="step-number">4</span>
                                        <div class="step-content">
                                            <h6>Armazenamento Vetorial</h6>
                                            <p>Indexa√ß√£o em banco de dados vetorial para busca r√°pida</p>
                                        </div>
                                    </div>
                                    <div class="step">
                                        <span class="step-number">5</span>
                                        <div class="step-content">
                                            <h6>Busca por Similaridade</h6>
                                            <p>Recupera√ß√£o de contexto relevante baseado na pergunta do cliente</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="embedding-models">
                                <h5>Modelos de Embedding</h5>
                                <div class="model-grid">
                                    <div class="model-card">
                                        <h6>text-embedding-3-small</h6>
                                        <p><strong>Provedor:</strong> OpenAI via OpenRouter</p>
                                        <p><strong>Dimens√µes:</strong> 1536</p>
                                        <p><strong>Custo:</strong> $0.00002/1K tokens</p>
                                        <p><strong>Uso:</strong> Embedding principal para textos gerais</p>
                                    </div>
                                    <div class="model-card">
                                        <h6>text-embedding-3-large</h6>
                                        <p><strong>Provedor:</strong> OpenAI via OpenRouter</p>
                                        <p><strong>Dimens√µes:</strong> 3072</p>
                                        <p><strong>Custo:</strong> $0.00013/1K tokens</p>
                                        <p><strong>Uso:</strong> Embedding de alta precis√£o para documentos importantes</p>
                                    </div>
                                    <div class="model-card">
                                        <h6>multilingual-e5-large</h6>
                                        <p><strong>Provedor:</strong> Hugging Face</p>
                                        <p><strong>Dimens√µes:</strong> 1024</p>
                                        <p><strong>Custo:</strong> Gratuito</p>
                                        <p><strong>Uso:</strong> Fallback para textos multil√≠ngues</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="similarity-search">
                            <h4>Sistema de Busca por Similaridade</h4>
                            
                            <div class="similarity-process">
                                <h5>Algoritmo de Similaridade</h5>
                                <div class="algorithm-explanation">
                                    <div class="algorithm-step">
                                        <h6>1. Embedding da Pergunta</h6>
                                        <p>Pergunta do cliente √© convertida em vetor usando o mesmo modelo de embedding</p>
                                        <pre><code>const questionEmbedding = await embeddingModel.embed(userQuestion);</code></pre>
                                    </div>
                                    
                                    <div class="algorithm-step">
                                        <h6>2. Busca Vetorial</h6>
                                        <p>Busca por similaridade coseno no banco de dados vetorial</p>
                                        <pre><code>const similarChunks = await vectorDB.search({
  vector: questionEmbedding,
  topK: 5,
  threshold: 0.7
});</code></pre>
                                    </div>
                                    
                                    <div class="algorithm-step">
                                        <h6>3. Ranking e Filtragem</h6>
                                        <p>Ordena√ß√£o por score de similaridade e filtragem por relev√¢ncia</p>
                                        <pre><code>const relevantContext = similarChunks
  .filter(chunk => chunk.score > 0.7)
  .slice(0, 3)
  .map(chunk => chunk.content);</code></pre>
                                    </div>
                                    
                                    <div class="algorithm-step">
                                        <h6>4. Constru√ß√£o do Contexto</h6>
                                        <p>Combina√ß√£o dos chunks mais relevantes para formar o contexto</p>
                                        <pre><code>const context = relevantContext.join('\n\n');
const prompt = buildPrompt(userQuestion, context, companyInfo);</code></pre>
                                    </div>
                                </div>
                            </div>

                            <div class="similarity-metrics">
                                <h5>M√©tricas de Similaridade</h5>
                                <div class="metrics-explanation">
                                    <div class="metric-item">
                                        <h6>Similaridade Coseno</h6>
                                        <p>Medida principal: varia de -1 a 1, onde 1 = id√™ntico</p>
                                        <p><strong>Threshold:</strong> 0.7 (m√≠nimo para considerar relevante)</p>
                                    </div>
                                    <div class="metric-item">
                                        <h6>Dist√¢ncia Euclidiana</h6>
                                        <p>M√©trica secund√°ria para desempate</p>
                                        <p><strong>Uso:</strong> Quando m√∫ltiplos chunks t√™m score similar</p>
                                    </div>
                                    <div class="metric-item">
                                        <h6>Score de Relev√¢ncia</h6>
                                        <p>Combina√ß√£o de similaridade + metadados (data, categoria)</p>
                                        <p><strong>Peso:</strong> 70% similaridade + 30% metadados</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="training-data-sources">
                            <h4>Fontes de Dados para Treinamento</h4>
                            
                            <div class="data-sources-grid">
                                <div class="source-item">
                                    <h5>üåê Website da Empresa</h5>
                                    <ul>
                                        <li>P√°ginas principais (sobre, servi√ßos, produtos)</li>
                                        <li>FAQ e documenta√ß√£o</li>
                                        <li>Pol√≠ticas e termos de uso</li>
                                        <li>Blog posts e artigos</li>
                                    </ul>
                                    <p><strong>Atualiza√ß√£o:</strong> Semanal autom√°tica</p>
                                </div>
                                
                                <div class="source-item">
                                    <h5>üí¨ Hist√≥rico de Conversas</h5>
                                    <ul>
                                        <li>Mensagens de tickets resolvidos</li>
                                        <li>Perguntas frequentes identificadas</li>
                                        <li>Respostas bem avaliadas</li>
                                        <li>Padr√µes de linguagem da empresa</li>
                                    </ul>
                                    <p><strong>Atualiza√ß√£o:</strong> Di√°ria incremental</p>
                                </div>
                                
                                <div class="source-item">
                                    <h5>üìÑ Documentos Manuais</h5>
                                    <ul>
                                        <li>Manuais de produtos/servi√ßos</li>
                                        <li>Cat√°logos e listas de pre√ßos</li>
                                        <li>Procedimentos internos</li>
                                        <li>Scripts de atendimento</li>
                                    </ul>
                                    <p><strong>Atualiza√ß√£o:</strong> Manual via upload</p>
                                </div>
                                
                                <div class="source-item">
                                    <h5>üéØ Treinamento Customizado</h5>
                                    <ul>
                                        <li>Perguntas e respostas espec√≠ficas</li>
                                        <li>Casos de uso particulares</li>
                                        <li>Linguagem e tom da marca</li>
                                        <li>Regras de neg√≥cio espec√≠ficas</li>
                                    </ul>
                                    <p><strong>Atualiza√ß√£o:</strong> Sob demanda</p>
                                </div>
                            </div>
                        </div>

                        <div class="vector-database">
                            <h4>Banco de Dados Vetorial</h4>
                            
                            <div class="database-options">
                                <h5>Op√ß√µes de Implementa√ß√£o</h5>
                                <div class="db-comparison">
                                    <div class="db-option recommended">
                                        <h6>üèÜ Pinecone (Recomendado)</h6>
                                        <div class="pros-cons">
                                            <div class="pros">
                                                <h7>Pr√≥s:</h7>
                                                <ul>
                                                    <li>Managed service (sem manuten√ß√£o)</li>
                                                    <li>Escalabilidade autom√°tica</li>
                                                    <li>Performance otimizada</li>
                                                    <li>Integra√ß√£o simples</li>
                                                </ul>
                                            </div>
                                            <div class="cons">
                                                <h7>Contras:</h7>
                                                <ul>
                                                    <li>Custo por uso</li>
                                                    <li>Depend√™ncia externa</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <p><strong>Custo:</strong> $70/m√™s para 100K vetores</p>
                                    </div>
                                    
                                    <div class="db-option">
                                        <h6>üêò PostgreSQL + pgvector</h6>
                                        <div class="pros-cons">
                                            <div class="pros">
                                                <h7>Pr√≥s:</h7>
                                                <ul>
                                                    <li>Integra√ß√£o com banco existente</li>
                                                    <li>Sem custos adicionais</li>
                                                    <li>Controle total</li>
                                                    <li>ACID compliance</li>
                                                </ul>
                                            </div>
                                            <div class="cons">
                                                <h7>Contras:</h7>
                                                <ul>
                                                    <li>Performance limitada</li>
                                                    <li>Manuten√ß√£o manual</li>
                                                    <li>Escalabilidade complexa</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <p><strong>Custo:</strong> Apenas recursos de servidor</p>
                                    </div>
                                    
                                    <div class="db-option">
                                        <h6>üîç Weaviate</h6>
                                        <div class="pros-cons">
                                            <div class="pros">
                                                <h7>Pr√≥s:</h7>
                                                <ul>
                                                    <li>Open source</li>
                                                    <li>Recursos avan√ßados</li>
                                                    <li>M√∫ltiplos tipos de dados</li>
                                                    <li>GraphQL API</li>
                                                </ul>
                                            </div>
                                            <div class="cons">
                                                <h7>Contras:</h7>
                                                <ul>
                                                    <li>Complexidade de setup</li>
                                                    <li>Curva de aprendizado</li>
                                                    <li>Recursos de servidor</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <p><strong>Custo:</strong> Self-hosted ou $25/m√™s cloud</p>
                                    </div>
                                </div>
                            </div>

                            <div class="database-schema">
                                <h5>Estrutura do Banco Vetorial</h5>
                                <pre><code>-- Tabela para armazenar embeddings
CREATE TABLE ai_embeddings (
  id SERIAL PRIMARY KEY,
  company_id INTEGER REFERENCES companies(id),
  content_type VARCHAR(50), -- 'website', 'conversation', 'document', 'manual'
  content_text TEXT NOT NULL,
  content_summary TEXT,
  embedding VECTOR(1536), -- Para text-embedding-3-small
  metadata JSONB, -- {category, url, date, tags, etc}
  similarity_threshold DECIMAL(3,2) DEFAULT 0.7,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para performance
CREATE INDEX idx_ai_embeddings_company ON ai_embeddings(company_id);
CREATE INDEX idx_ai_embeddings_type ON ai_embeddings(content_type);
CREATE INDEX idx_ai_embeddings_vector ON ai_embeddings USING ivfflat (embedding vector_cosine_ops);

-- Tabela para controle de treinamento
CREATE TABLE ai_training_jobs (
  id SERIAL PRIMARY KEY,
  company_id INTEGER REFERENCES companies(id),
  job_type VARCHAR(50), -- 'website_crawl', 'document_upload', 'conversation_analysis'
  status VARCHAR(20), -- 'pending', 'running', 'completed', 'failed'
  source_url VARCHAR(500),
  processed_chunks INTEGER DEFAULT 0,
  total_chunks INTEGER DEFAULT 0,
  error_message TEXT,
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                            </div>
                        </div>

                        <div class="training-pipeline">
                            <h4>Pipeline de Treinamento</h4>
                            
                            <div class="pipeline-stages">
                                <div class="stage">
                                    <h5>Est√°gio 1: Coleta de Dados</h5>
                                    <div class="stage-details">
                                        <h6>Extra√ß√£o de Website</h6>
                                        <pre><code>// Servi√ßo de extra√ß√£o de website
class WebsiteExtractionService {
  async extractWebsite(url: string, companyId: number) {
    const crawler = new WebCrawler({
      maxPages: 50,
      respectRobotsTxt: true,
      delay: 1000
    });
    
    const pages = await crawler.crawl(url);
    
    for (const page of pages) {
      const chunks = this.chunkText(page.content, 500);
      await this.processChunks(chunks, companyId, 'website');
    }
  }
}</code></pre>
                                        
                                        <h6>An√°lise de Conversas</h6>
                                        <pre><code>// Extra√ß√£o de padr√µes de conversas
class ConversationAnalysisService {
  async analyzeConversations(companyId: number) {
    const resolvedTickets = await Ticket.findAll({
      where: { companyId, status: 'closed' },
      include: [{ model: Message }]
    });
    
    for (const ticket of resolvedTickets) {
      const conversation = this.extractQAPairs(ticket.messages);
      await this.createEmbeddings(conversation, companyId);
    }
  }
}</code></pre>
                                    </div>
                                </div>
                                
                                <div class="stage">
                                    <h5>Est√°gio 2: Processamento de Texto</h5>
                                    <div class="stage-details">
                                        <h6>Chunking Inteligente</h6>
                                        <pre><code>class TextChunker {
  chunkText(text: string, maxTokens: number = 500): string[] {
    // Divis√£o por par√°grafos primeiro
    const paragraphs = text.split('\n\n');
    const chunks: string[] = [];
    let currentChunk = '';
    
    for (const paragraph of paragraphs) {
      const tokens = this.countTokens(currentChunk + paragraph);
      
      if (tokens > maxTokens && currentChunk) {
        chunks.push(currentChunk.trim());
        currentChunk = paragraph;
      } else {
        currentChunk += (currentChunk ? '\n\n' : '') + paragraph;
      }
    }
    
    if (currentChunk) chunks.push(currentChunk.trim());
    return chunks;
  }
}</code></pre>
                                        
                                        <h6>Limpeza e Normaliza√ß√£o</h6>
                                        <pre><code>class TextCleaner {
  cleanText(text: string): string {
    return text
      .replace(/\s+/g, ' ') // M√∫ltiplos espa√ßos
      .replace(/[^\w\s\.\,\!\?\-]/g, '') // Caracteres especiais
      .trim()
      .toLowerCase();
  }
  
  extractKeywords(text: string): string[] {
    // Extra√ß√£o de palavras-chave relevantes
    const stopWords = ['o', 'a', 'de', 'para', 'com', 'em'];
    return text.split(' ')
      .filter(word => !stopWords.includes(word))
      .filter(word => word.length > 3);
  }
}</code></pre>
                                    </div>
                                </div>
                                
                                <div class="stage">
                                    <h5>Est√°gio 3: Gera√ß√£o de Embeddings</h5>
                                    <div class="stage-details">
                                        <h6>Servi√ßo de Embedding</h6>
                                        <pre><code>class EmbeddingService {
  async generateEmbedding(text: string): Promise<number[]> {
    const response = await openRouterClient.embeddings.create({
      model: 'text-embedding-3-small',
      input: text
    });
    
    return response.data[0].embedding;
  }
  
  async batchEmbeddings(texts: string[]): Promise<number[][]> {
    // Processamento em lotes para efici√™ncia
    const batches = this.chunkArray(texts, 100);
    const allEmbeddings: number[][] = [];
    
    for (const batch of batches) {
      const embeddings = await this.generateEmbedding(batch.join(' '));
      allEmbeddings.push(...embeddings);
    }
    
    return allEmbeddings;
  }
}</code></pre>
                                    </div>
                                </div>
                                
                                <div class="stage">
                                    <h5>Est√°gio 4: Indexa√ß√£o e Armazenamento</h5>
                                    <div class="stage-details">
                                        <h6>Armazenamento no Banco Vetorial</h6>
                                        <pre><code>class VectorStorageService {
  async storeEmbedding(data: {
    companyId: number;
    contentType: string;
    text: string;
    embedding: number[];
    metadata: any;
  }) {
    await AIEmbedding.create({
      company_id: data.companyId,
      content_type: data.contentType,
      content_text: data.text,
      content_summary: this.generateSummary(data.text),
      embedding: data.embedding,
      metadata: data.metadata
    });
  }
  
  async searchSimilar(
    queryEmbedding: number[], 
    companyId: number, 
    limit: number = 5
  ) {
    return await AIEmbedding.findAll({
      where: { company_id: companyId },
      order: [
        [sequelize.fn('cosine_distance', 
          sequelize.col('embedding'), 
          queryEmbedding
        ), 'ASC']
      ],
      limit
    });
  }
}</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="training-interface">
                            <h4>Interface de Treinamento</h4>
                            
                            <div class="interface-mockup">
                                <h5>Painel de Treinamento do PEPE</h5>
                                <div class="training-sections">
                                    <div class="training-section">
                                        <h6>üìä Status do Treinamento</h6>
                                        <ul>
                                            <li>Total de chunks processados: 1,247</li>
                                            <li>√öltima atualiza√ß√£o: 2 horas atr√°s</li>
                                            <li>Qualidade do embedding: 94%</li>
                                            <li>Cobertura de t√≥picos: 87%</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="training-section">
                                        <h6>üåê Fontes de Dados</h6>
                                        <ul>
                                            <li>Website: ‚úÖ 45 p√°ginas processadas</li>
                                            <li>Conversas: ‚úÖ 892 tickets analisados</li>
                                            <li>Documentos: ‚è≥ 3 arquivos pendentes</li>
                                            <li>FAQ Manual: ‚úÖ 67 pares Q&A</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="training-section">
                                        <h6>üéØ Teste de Qualidade</h6>
                                        <div class="quality-test">
                                            <input type="text" placeholder="Digite uma pergunta para testar..." />
                                            <button>Testar Similaridade</button>
                                            <div class="test-results">
                                                <p><strong>Chunks encontrados:</strong> 3</p>
                                                <p><strong>Melhor score:</strong> 0.89</p>
                                                <p><strong>Contexto relevante:</strong> Sim</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="training-section">
                                        <h6>‚öôÔ∏è Configura√ß√µes Avan√ßadas</h6>
                                        <ul>
                                            <li>Threshold de similaridade: 0.7</li>
                                            <li>Tamanho do chunk: 500 tokens</li>
                                            <li>Overlap entre chunks: 50 tokens</li>
                                            <li>Modelo de embedding: text-embedding-3-small</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="training-costs">
                            <h4>Custos de Treinamento</h4>
                            
                            <div class="cost-breakdown">
                                <div class="cost-item">
                                    <h5>üí∞ Embedding Generation</h5>
                                    <p><strong>Modelo:</strong> text-embedding-3-small</p>
                                    <p><strong>Custo:</strong> $0.00002 por 1K tokens</p>
                                    <p><strong>Estimativa:</strong> ~$2-5 por empresa (setup inicial)</p>
                                </div>
                                
                                <div class="cost-item">
                                    <h5>üóÑÔ∏è Vector Storage</h5>
                                    <p><strong>Pinecone:</strong> $70/m√™s para 100K vetores</p>
                                    <p><strong>PostgreSQL:</strong> Inclu√≠do no servidor</p>
                                    <p><strong>Estimativa:</strong> $0.70 por empresa/m√™s (Pinecone)</p>
                                </div>
                                
                                <div class="cost-item">
                                    <h5>üîÑ Atualiza√ß√µes</h5>
                                    <p><strong>Website crawling:</strong> Semanal</p>
                                    <p><strong>Conversation analysis:</strong> Di√°rio</p>
                                    <p><strong>Estimativa:</strong> $1-3 por empresa/m√™s</p>
                                </div>
                                
                                <div class="cost-total">
                                    <h5>üìä Total Estimado</h5>
                                    <p><strong>Setup inicial:</strong> $2-5 por empresa</p>
                                    <p><strong>Custo mensal:</strong> $2-6 por empresa</p>
                                    <p><strong>ROI esperado:</strong> 300-500% (redu√ß√£o de atendimento manual)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="apis" class="section">
                <h2>APIs e Endpoints</h2>
                <div class="content">
                    <h3>Principais Rotas</h3>
                    <div class="api-group">
                        <h4>Autentica√ß√£o</h4>
                        <p><code>src/routes/authRoutes.ts</code></p>
                        <ul>
                            <li>POST /auth/login</li>
                            <li>POST /auth/refresh</li>
                            <li>POST /auth/logout</li>
                        </ul>
                    </div>

                    <div class="api-group">
                        <h4>Tickets</h4>
                        <p><code>src/routes/ticketRoutes.ts</code></p>
                        <ul>
                            <li>GET /tickets</li>
                            <li>POST /tickets</li>
                            <li>PUT /tickets/:id</li>
                            <li>DELETE /tickets/:id</li>
                        </ul>
                    </div>

                    <div class="api-group">
                        <h4>WhatsApp</h4>
                        <p><code>src/routes/whatsappRoutes.ts</code></p>
                        <ul>
                            <li>GET /whatsapp</li>
                            <li>POST /whatsapp</li>
                            <li>PUT /whatsapp/:id</li>
                            <li>POST /whatsapp/:id/start</li>
                        </ul>
                    </div>

                    <div class="api-group">
                        <h4>Mensagens</h4>
                        <p><code>src/routes/messageRoutes.ts</code></p>
                        <ul>
                            <li>GET /messages</li>
                            <li>POST /messages</li>
                            <li>PUT /messages/:id</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="ai-agent" class="section"<h2>Agente de IA - Implanta√ß√£o Futura</h2>
                <div class="content">
                    <!-- Navega√ß√£o por abas internas -->
                    <div class="ai-tabs-navigation">
                        <button class="ai-tab-btn active" data-tab="overview">Vis√£o Geral</button>
                        <button class="ai-tab-btn" data-tab="pepe-agent">Agente PEPE</button>
                        <button class="ai-tab-btn" data-tab="plan-integration">Integra√ß√£o com Planos</button>
                        <button class="ai-tab-btn" data-tab="ui-changes">Mudan√ßas na Interface</button>
                        <button class="ai-tab-btn" data-tab="technical-specs">Especifica√ß√µes T√©cnicas</button>
                        <button class="ai-tab-btn" data-tab="training">Treinamento</button>
                        <button class="ai-tab-btn" data-tab="fluxograma">Fluxograma</button>
                    </div>

                    <!-- Aba: Vis√£o Geral -->
                    <div class="ai-tab-content active" id="overview">
                        <div class="ai-overview">
                            <h3>Vis√£o Geral do Projeto</h3>
                            <p>O Smart Atendimento ser√° expandido com o <strong>Agente PEPE</strong> (Processador Eletr√¥nico de Perguntas e Esclarecimentos), um agente de IA inteligente que revolucionar√° o atendimento ao cliente atrav√©s da integra√ß√£o com OpenRouter.</p>
                            
                            <div class="pepe-highlights">
                                <h4>Caracter√≠sticas Principais do PEPE</h4>
                                <div class="highlight-grid">
                                    <div class="highlight-item">
                                        <h5>ü§ñ Identidade Pr√≥pria</h5>
                                        <p>Usu√°rio dedicado no sistema (pepe@ai.system) com √≠cone visual distintivo</p>
                                    </div>
                                    <div class="highlight-item">
                                        <h5>üìù Mensagens Limpas</h5>
                                        <p>Sem assinatura ou identifica√ß√£o nas mensagens enviadas</p>
                                    </div>
                                    <div class="highlight-item">
                                        <h5>üéØ Ativa√ß√£o Inteligente</h5>
                                        <p>Inicia ap√≥s conclus√£o do fluxo de chatbot b√°sico dos setores</p>
                                    </div>
                                    <div class="highlight-item">
                                        <h5>‚ö° Controle Total</h5>
                                        <p>Operadores podem pausar, retomar ou assumir controle a qualquer momento</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba: Agente PEPE -->
                    <div class="ai-tab-content" id="pepe-agent">
                        <h3>Agente PEPE - Especifica√ß√µes Detalhadas</h3>
                        
                        <div class="pepe-identity">
                            <h4>Identidade e Comportamento</h4>
                            <ul>
                                <li><strong>Nome:</strong> PEPE (Processador Eletr√¥nico de Perguntas e Esclarecimentos)</li>
                                <li><strong>Usu√°rio Sistema:</strong> pepe@ai.system</li>
                                <li><strong>√çcone Visual:</strong> ü§ñ para identifica√ß√£o nos tickets</li>
                                <li><strong>Assinatura:</strong> Nenhuma (mensagens sem identifica√ß√£o)</li>
                                <li><strong>Perfil:</strong> ai_agent (novo tipo de usu√°rio)</li>
                            </ul>
                        </div>

                        <div class="pepe-activation">
                            <h4>Fluxo de Ativa√ß√£o</h4>
                            <div class="activation-steps">
                                <div class="step">
                                    <span class="step-number">1</span>
                                    <div class="step-content">
                                        <h5>Cliente Inicia Conversa</h5>
                                        <p>Mensagem recebida via WhatsApp</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">2</span>
                                    <div class="step-content">
                                        <h5>Chatbot B√°sico</h5>
                                        <p>Sistema apresenta op√ß√µes de setores</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">3</span>
                                    <div class="step-content">
                                        <h5>Sele√ß√£o de Setor</h5>
                                        <p>Cliente escolhe setor de atendimento</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">4</span>
                                    <div class="step-content">
                                        <h5>Verifica√ß√£o de Plano</h5>
                                        <p>Sistema verifica se empresa tem acesso ao PEPE</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">5</span>
                                    <div class="step-content">
                                        <h5>PEPE Ativado</h5>
                                        <p>Agente assume o atendimento automaticamente</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pepe-controls">
                            <h4>Controles Operacionais</h4>
                            <div class="control-grid">
                                <div class="control-item">
                                    <h5>‚è∏Ô∏è Pausa Manual</h5>
                                    <p>Operadores podem pausar PEPE e transferir para "Aguardando"</p>
                                </div>
                                <div class="control-item">
                                    <h5>üîÑ Transfer√™ncia Autom√°tica</h5>
                                    <p>PEPE transfere automaticamente quando n√£o consegue responder</p>
                                </div>
                                <div class="control-item">
                                    <h5>üö® Alertas Inteligentes</h5>
                                    <p>Notifica√ß√µes quando PEPE precisa de interven√ß√£o humana</p>
                                </div>
                                <div class="control-item">
                                    <h5>üë§ Assumir Controle</h5>
                                    <p>Atendentes podem assumir controle direto do ticket</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba: Integra√ß√£o com Planos -->
                    <div class="ai-tab-content" id="plan-integration">
                        <h3>Integra√ß√£o com Sistema de Planos</h3>
                        
                        <div class="plan-parameter">
                            <h4>Novo Par√¢metro: ai_agent_enabled</h4>
                            <p><strong>Localiza√ß√£o:</strong> Configura√ß√µes > Planos do Sistema</p>
                            
                            <div class="parameter-behavior">
                                <div class="behavior-item enabled">
                                    <h5>‚úÖ Se Habilitado (true)</h5>
                                    <ul>
                                        <li>Libera o agente PEPE na tela "Minhas Conex√µes"</li>
                                        <li>Mostra aba "Agente de IA" nas integra√ß√µes</li>
                                        <li>Permite configura√ß√£o e uso do agente</li>
                                        <li>Ativa processamento de IA p√≥s-chatbot</li>
                                    </ul>
                                </div>
                                <div class="behavior-item disabled">
                                    <h5>‚ùå Se Desabilitado (false)</h5>
                                    <ul>
                                        <li>Esconde completamente a aba "Agente de IA"</li>
                                        <li>N√£o processa mensagens com IA</li>
                                        <li>Mant√©m fluxo tradicional de atendimento</li>
                                        <li>Exibe mensagem de upgrade quando necess√°rio</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="request-limits">
                            <h4>Controle de Requests Mensais</h4>
                            <p><strong>Nova Funcionalidade:</strong> Limite de requests de IA por empresa/m√™s</p>
                            
                            <div class="limits-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Plano</th>
                                            <th>Agente IA</th>
                                            <th>Requests/M√™s</th>
                                            <th>Custo Estimado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>B√°sico</td>
                                            <td>‚ùå N√£o</td>
                                            <td>0</td>
                                            <td>-</td>
                                        </tr>
                                        <tr>
                                            <td>Premium</td>
                                            <td>‚úÖ Sim</td>
                                            <td>1.000</td>
                                            <td>~$15/m√™s</td>
                                        </tr>
                                        <tr>
                                            <td>Enterprise</td>
                                            <td>‚úÖ Sim</td>
                                            <td>5.000</td>
                                            <td>~$50/m√™s</td>
                                        </tr>
                                        <tr>
                                            <td>Custom</td>
                                            <td>‚úÖ Sim</td>
                                            <td>Ilimitado</td>
                                            <td>Negoci√°vel</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="request-monitoring">
                                <h5>Monitoramento de Uso</h5>
                                <ul>
                                    <li>Contador de requests utilizados no m√™s</li>
                                    <li>Alertas quando atingir 80% do limite</li>
                                    <li>Bloqueio autom√°tico ao atingir 100%</li>
                                    <li>Relat√≥rio mensal de uso por empresa</li>
                                </ul>
                            </div>
                        </div>

                        <div class="database-changes">
                            <h4>Altera√ß√µes no Banco de Dados</h4>
                            <pre><code>-- Adicionar par√¢metro de IA nos planos
ALTER TABLE plans ADD COLUMN ai_agent_enabled BOOLEAN DEFAULT false;
ALTER TABLE plans ADD COLUMN ai_monthly_requests INTEGER DEFAULT 0;

-- Tabela para controle de uso mensal
CREATE TABLE ai_usage_tracking (
  id SERIAL PRIMARY KEY,
  company_id INTEGER REFERENCES companies(id),
  month_year VARCHAR(7), -- formato: 2024-03
  requests_used INTEGER DEFAULT 0,
  requests_limit INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para performance
CREATE INDEX idx_ai_usage_company_month ON ai_usage_tracking(company_id, month_year);</code></pre>
                        </div>
                    </div>

                    <!-- Aba: Mudan√ßas na Interface -->
                    <div class="ai-tab-content" id="ui-changes">
                        <h3>Mudan√ßas na Interface do Usu√°rio</h3>
                        
                        <div class="new-tab-pepe">
                            <h4>Nova Aba "Pepe AI" na Tela de Atendimentos</h4>
                            <p><strong>Localiza√ß√£o:</strong> Ao lado das abas "Atendendo" e "Aguardando"</p>
                            
                            <div class="tab-structure">
                                <div class="tabs-preview">
                                    <div class="tab-item">Aguardando</div>
                                    <div class="tab-item">Atendendo</div>
                                    <div class="tab-item new-tab">Pepe AI ü§ñ</div>
                                </div>
                            </div>

                            <div class="tab-behavior">
                                <h5>Comportamento da Nova Aba</h5>
                                <ul>
                                    <li><strong>Conte√∫do:</strong> Tickets sendo atendidos pelo agente PEPE</li>
                                    <li><strong>Filtro:</strong> WHERE aiAssisted = true AND status = 'open'</li>
                                    <li><strong>√çcone:</strong> ü§ñ nos tickets para identifica√ß√£o visual</li>
                                    <li><strong>Contador:</strong> N√∫mero de tickets ativos com IA</li>
                                    <li><strong>Atualiza√ß√£o:</strong> Tempo real via WebSocket</li>
                                </ul>
                            </div>
                        </div>

                        <div class="ticket-flow-change">
                            <h4>Mudan√ßa no Fluxo de Tickets</h4>
                            <p><strong>Situa√ß√£o Atual:</strong> Nova conversa ‚Üí Diretamente para "Aguardando"</p>
                            <p><strong>Nova Situa√ß√£o:</strong> Nova conversa ‚Üí Chatbot ‚Üí PEPE (se habilitado) ‚Üí "Pepe AI"</p>
                            
                            <div class="flow-diagram">
                                <div class="flow-step">
                                    <div class="step-box">Nova Mensagem</div>
                                    <div class="arrow">‚Üì</div>
                                </div>
                                <div class="flow-step">
                                    <div class="step-box">Chatbot B√°sico</div>
                                    <div class="arrow">‚Üì</div>
                                </div>
                                <div class="flow-step">
                                    <div class="step-box decision">Plano tem IA?</div>
                                    <div class="arrow-split">
                                        <div class="arrow-yes">Sim ‚Üí PEPE ‚Üí "Pepe AI"</div>
                                        <div class="arrow-no">N√£o ‚Üí "Aguardando"</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ai-integration-tab"<h4>Bot√£o "Treinar o Pepe" na Tela "Minhas Conex√µes"</h4>
                            <p><strong>Localiza√ß√£o:</strong> Minhas Conex√µes > Bot√£o "Treinar o Pepe" (ao lado de cada conex√£o WhatsApp)</p>
                            
                            <div class="integration-features">
                                <h5>Funcionalidades da Aba</h5>
                                <div class="feature-list">
                                    <div class="feature-item">
                                        <h6>üîß Configura√ß√µes B√°sicas</h6>
                                        <ul>
                                            <li>Ativar/Desativar PEPE</li>
                                            <li>Sele√ß√£o de modelo de IA</li>
                                            <li>Configura√ß√£o de temperatura</li>
                                        </ul>
                                    </div>
                                    <div class="feature-item">
                                        <h6>üìö Treinamento Personalizado</h6>
                                        <ul>
                                            <li>Informa√ß√µes da empresa</li>
                                            <li>Perguntas e respostas customizadas</li>
                                            <li>Extra√ß√£o autom√°tica do site</li>
                                        </ul>
                                    </div>
                                    <div class="feature-item">
                                        <h6>‚öôÔ∏è Controles Avan√ßados</h6>
                                        <ul>
                                            <li>Regras de transfer√™ncia</li>
                                            <li>Teste do agente</li>
                                            <li>Monitoramento de uso</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="visual-indicators">
                            <h4>Indicadores Visuais</h4>
                            <div class="indicator-list">
                                <div class="indicator-item">
                                    <span class="indicator-icon">ü§ñ</span>
                                    <div class="indicator-desc">
                                        <h6>√çcone do Ticket</h6>
                                        <p>Tickets atendidos por PEPE mostram √≠cone de rob√¥</p>
                                    </div>
                                </div>
                                <div class="indicator-item">
                                    <span class="indicator-icon">‚è∏Ô∏è</span>
                                    <div class="indicator-desc">
                                        <h6>Status de Pausa</h6>
                                        <p>Indicador quando IA est√° pausada no ticket</p>
                                    </div>
                                </div>
                                <div class="indicator-item">
                                    <span class="indicator-icon">üö®</span>
                                    <div class="indicator-desc">
                                        <h6>Alertas de IA</h6>
                                        <p>Notifica√ß√µes quando PEPE precisa de ajuda</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba: Especifica√ß√µes T√©cnicas -->
                    <div class="ai-tab-content" id="technical-specs">
                        <h3>Especifica√ß√µes T√©cnicas com OpenRouter</h3>

                        <div class="ai-features">
                            <h4>Funcionalidades Planejadas</h4>
                        <div class="feature-grid">
                            <div class="ai-feature-item">
                                <h4><i class="fas fa-brain"></i> Processamento de Linguagem Natural</h4>
                                <p>Compreens√£o avan√ßada de inten√ß√µes e contexto das mensagens dos clientes</p>
                                <ul>
                                    <li>An√°lise de sentimento</li>
                                    <li>Extra√ß√£o de entidades</li>
                                    <li>Classifica√ß√£o de inten√ß√µes</li>
                                </ul>
                            </div>
                            <div class="ai-feature-item">
                                <h4><i class="fas fa-comments"></i> Respostas Inteligentes</h4>
                                <p>Gera√ß√£o autom√°tica de respostas personalizadas e contextualmente relevantes</p>
                                <ul>
                                    <li>Base de conhecimento din√¢mica</li>
                                    <li>Respostas adaptativas</li>
                                    <li>Suporte multil√≠ngue</li>
                                </ul>
                            </div>
                            <div class="ai-feature-item">
                                <h4><i class="fas fa-chart-line"></i> Aprendizado Cont√≠nuo</h4>
                                <p>Sistema que evolui com base nas intera√ß√µes e feedback dos usu√°rios</p>
                                <ul>
                                    <li>Machine Learning adaptativo</li>
                                    <li>An√°lise de performance</li>
                                    <li>Otimiza√ß√£o autom√°tica</li>
                                </ul>
                            </div>
                            <div class="ai-feature-item">
                                <h4><i class="fas fa-route"></i> Roteamento Inteligente</h4>
                                <p>Direcionamento autom√°tico para o atendente mais adequado</p>
                                <ul>
                                    <li>An√°lise de especializa√ß√£o</li>
                                    <li>Balanceamento de carga</li>
                                    <li>Prioriza√ß√£o por urg√™ncia</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="ai-architecture">
                        <h3>Arquitetura T√©cnica Planejada</h3>
                        <div class="tech-stack">
                            <h4>Stack de IA com OpenRouter</h4>
                            <ul>
                                <li><strong>Provedor Principal:</strong> OpenRouter (Acesso unificado a m√∫ltiplos LLMs)</li>
                                <li><strong>Modelos Dispon√≠veis:</strong> GPT-4, Claude, Llama, Gemini, e outros</li>
                                <li><strong>SDK:</strong> OpenRouter JavaScript SDK</li>
                                <li><strong>Vector Database:</strong> Pinecone / Weaviate para embeddings</li>
                                <li><strong>Cache:</strong> Redis para respostas frequentes e rate limiting</li>
                                <li><strong>Fallback:</strong> Sistema de fallback entre diferentes modelos</li>
                            </ul>
                        </div>

                        <div class="integration-points">
                            <h4>Pontos de Integra√ß√£o</h4>
                            <p><strong>Arquivos a serem criados/modificados:</strong></p>
                            <ul>
                                <li><code>src/services/AIServices/</code> - Servi√ßos de IA com OpenRouter</li>
                                <li><code>src/libs/openRouter.ts</code> - Cliente OpenRouter configurado</li>
                                <li><code>src/models/AIKnowledgeBase.ts</code> - Base de conhecimento</li>
                                <li><code>src/models/AIConversation.ts</code> - Hist√≥rico de conversas IA</li>
                                <li><code>src/libs/aiAgent.ts</code> - Core do agente IA</li>
                                <li><code>src/middleware/aiMiddleware.ts</code> - Middleware de IA</li>
                                <li><code>src/jobs/aiTraining.ts</code> - Jobs de an√°lise e otimiza√ß√£o</li>
                            </ul>
                        </div>
                    </div>

                    <div class="ai-implementation">
                        <h3>Fases de Implementa√ß√£o</h3>
                        <div class="phase-timeline">
                            <div class="phase">
                                <h4>Fase 1 - Funda√ß√£o (Q1 2024)</h4>
                                <ul>
                                    <li>Integra√ß√£o com OpenRouter API</li>
                                    <li>Configura√ß√£o de m√∫ltiplos modelos (GPT-4, Claude, Llama)</li>
                                    <li>Sistema b√°sico de respostas autom√°ticas</li>
                                    <li>Interface de configura√ß√£o de IA</li>
                                    <li>M√©tricas b√°sicas de performance e custos</li>
                                </ul>
                            </div>
                            <div class="phase">
                                <h4>Fase 2 - Intelig√™ncia (Q2 2024)</h4>
                                <ul>
                                    <li>Sistema de fallback autom√°tico entre modelos</li>
                                    <li>Otimiza√ß√£o de custos com sele√ß√£o inteligente de modelos</li>
                                    <li>Sistema de feedback e melhoria cont√≠nua</li>
                                    <li>Roteamento inteligente avan√ßado</li>
                                    <li>An√°lise de sentimento em tempo real</li>
                                </ul>
                            </div>
                            <div class="phase">
                                <h4>Fase 3 - Otimiza√ß√£o (Q3 2024)</h4>
                                <ul>
                                    <li>Personaliza√ß√£o por empresa/setor com modelos espec√≠ficos</li>
                                    <li>Balanceamento de carga entre diferentes provedores</li>
                                    <li>Integra√ß√£o com CRM externo</li>
                                    <li>Analytics avan√ßados de IA e custos por modelo</li>
                                    <li>API p√∫blica para desenvolvedores</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="ai-benefits">
                        <h3>Benef√≠cios Esperados com OpenRouter</h3>
                        <div class="benefits-grid">
                            <div class="benefit-item">
                                <h4><i class="fas fa-clock"></i> Redu√ß√£o de Tempo de Resposta</h4>
                                <p>Respostas instant√¢neas 24/7, reduzindo tempo m√©dio de primeira resposta em at√© 90%</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-users"></i> Melhoria na Satisfa√ß√£o</h4>
                                <p>Atendimento mais preciso e personalizado, aumentando NPS em at√© 40%</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-chart-bar"></i> Otimiza√ß√£o de Recursos</h4>
                                <p>Redu√ß√£o de carga de trabalho manual em at√© 60%, focando atendentes em casos complexos</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-cogs"></i> Escalabilidade</h4>
                                <p>Capacidade de atender milhares de conversas simult√¢neas sem degrada√ß√£o de qualidade</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-dollar-sign"></i> Otimiza√ß√£o de Custos</h4>
                                <p>Sele√ß√£o inteligente de modelos baseada em custo-benef√≠cio, reduzindo gastos em at√© 50%</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-shield-alt"></i> Redund√¢ncia e Confiabilidade</h4>
                                <p>Sistema de fallback autom√°tico garante disponibilidade mesmo com falhas de provedores</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-brain"></i> Diversidade de Modelos</h4>
                                <p>Acesso a m√∫ltiplos LLMs permite escolher o melhor modelo para cada tipo de intera√ß√£o</p>
                            </div>
                            <div class="benefit-item">
                                <h4><i class="fas fa-chart-line"></i> Flexibilidade Estrat√©gica</h4>
                                <p>Capacidade de adaptar estrat√©gia de IA conforme evolu√ß√£o do mercado e novos modelos</p>
                            </div>
                        </div>
                    </div>

                    <div class="ai-config">
                        <h3>Configura√ß√µes Futuras com OpenRouter</h3>
                        <p><strong>Vari√°veis de ambiente adicionais:</strong></p>
                        <pre><code># OpenRouter Configuration
AI_ENABLED=true
AI_PROVIDER=openrouter
OPENROUTER_API_KEY=your-openrouter-api-key
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# Model Configuration
AI_PRIMARY_MODEL=openai/gpt-4-turbo-preview
AI_FALLBACK_MODEL=anthropic/claude-3-haiku
AI_BUDGET_MODEL=meta-llama/llama-3-8b-instruct
AI_TEMPERATURE=0.7
AI_MAX_TOKENS=150

# Model Selection Strategy
AI_MODEL_SELECTION=smart  # smart, cost-optimized, performance
AI_MAX_COST_PER_REQUEST=0.01  # USD
AI_FALLBACK_ENABLED=true

# Vector Database
VECTOR_DB_URL=your-vector-db-url
VECTOR_DB_API_KEY=your-vector-db-key

# Monitoring & Analytics
AI_ANALYTICS_ENABLED=true
AI_COST_TRACKING=true
AI_PERFORMANCE_MONITORING=true</code></pre>

                        <h3>M√©tricas de Monitoramento com OpenRouter</h3>
                        <ul>
                            <li><strong>Accuracy Rate:</strong> Taxa de acerto das respostas IA por modelo</li>
                            <li><strong>Response Time:</strong> Tempo m√©dio de resposta por modelo</li>
                            <li><strong>Cost per Request:</strong> Custo m√©dio por requisi√ß√£o por modelo</li>
                            <li><strong>Model Usage Distribution:</strong> Distribui√ß√£o de uso entre modelos</li>
                            <li><strong>Fallback Rate:</strong> Taxa de uso do modelo de fallback</li>
                            <li><strong>Escalation Rate:</strong> Taxa de transfer√™ncia para humanos</li>
                            <li><strong>User Satisfaction:</strong> Avalia√ß√£o dos usu√°rios sobre respostas IA</li>
                            <li><strong>Cost Efficiency:</strong> Rela√ß√£o custo-benef√≠cio por modelo</li>
                        </ul>
                    </div>

                    <div class="ai-roadmap"<h3>Roadmap de Desenvolvimento</h3>
                        <div class="roadmap-item">
                            <h4>üöÄ Pr√≥ximos Passos com OpenRouter</h4>
                            <ol>
                                <li>An√°lise de requisitos detalhada com stakeholders</li>
                                <li>Configura√ß√£o da conta OpenRouter e an√°lise de modelos dispon√≠veis</li>
                                <li>Prova de conceito com diferentes modelos (GPT-4, Claude, Llama)</li>
                                <li>Implementa√ß√£o do sistema de fallback e sele√ß√£o inteligente</li>
                                <li>Desenvolvimento do MVP do agente com monitoramento de custos</li>
                                <li>Testes A/B comparando performance e custos entre modelos</li>
                                <li>Otimiza√ß√£o da estrat√©gia de sele√ß√£o de modelos</li>
                                <li>Refinamento baseado em feedback e m√©tricas de custo-benef√≠cio</li>
                                <li>Lan√ßamento gradual para toda a base com controle de custos</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Aba: Fluxograma -->
                    <div class="ai-tab-content" id="fluxograma">
                        <h3>Fluxograma Completo - Integra√ß√£o Agente PEPE</h3>
                        
                        <div class="flowchart-overview">
                            <h4>üîÑ Fluxo Principal de Integra√ß√£o</h4>
                            <p>Este fluxograma mostra todo o processo de integra√ß√£o do PEPE, desde a configura√ß√£o inicial at√© o atendimento automatizado.</p>
                        </div>

                        <div class="flowchart-stages">
                            <h4>üìã Etapas do Fluxograma</h4>
                            
                            <div class="stage-flow">
                                <h5>1Ô∏è‚É£ Configura√ß√£o Inicial</h5>
                                <div class="flow-description">
                                    <p><strong>Admin do Sistema:</strong></p>
                                    <ul>
                                        <li>Acessa Configura√ß√µes > Planos</li>
                                        <li>Habilita par√¢metro <code>ai_agent_enabled = true</code></li>
                                        <li>Empresa ganha acesso ao PEPE</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="stage-flow">
                                <h5>2Ô∏è‚É£ Treinamento do PEPE</h5>
                                <div class="flow-description">
                                    <p><strong>Usu√°rio da Empresa:</strong></p>
                                    <ul>
                                        <li>Acessa "Minhas Conex√µes"</li>
                                        <li>Clica bot√£o "Treinar IA"</li>
                                        <li>Preenche formul√°rio da empresa</li>
                                        <li>Clica "Treinar/Concluir"</li>
                                        <li>PEPE √© automaticamente ativado</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="stage-flow">
                                <h5>3Ô∏è‚É£ Processamento de Mensagens</h5>
                                <div class="flow-description">
                                    <p><strong>Fluxo Autom√°tico:</strong></p>
                                    <ul>
                                        <li>Nova mensagem WhatsApp chega</li>
                                        <li>Chatbot b√°sico apresenta setores</li>
                                        <li>Cliente escolhe setor</li>
                                        <li>Sistema verifica se PEPE est√° ativo</li>
                                        <li>PEPE assume o ticket automaticamente</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="stage-flow">
                                <h5>4Ô∏è‚É£ Processamento com IA</h5>
                                <div class="flow-description">
                                    <p><strong>PEPE em A√ß√£o:</strong></p>
                                    <ul>
                                        <li>Busca dados de treinamento da empresa</li>
                                        <li>Gera embedding da pergunta do cliente</li>
                                        <li>Busca similaridade no banco vetorial</li>
                                        <li>Monta prompt com contexto relevante</li>
                                        <li>Envia para DeepSeek API</li>
                                        <li>Recebe e envia resposta para cliente</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="stage-flow">
                                <h5>5Ô∏è‚É£ Controles Operacionais</h5>
                                <div class="flow-description">
                                    <p><strong>Interven√ß√£o Humana:</strong></p>
                                    <ul>
                                        <li>Atendente pode pausar PEPE</li>
                                        <li>Atendente pode assumir controle</li>
                                        <li>PEPE transfere automaticamente quando n√£o consegue responder</li>
                                        <li>Sistema gera alertas para interven√ß√£o</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="decision-points">
                            <h4>üéØ Pontos de Decis√£o Cr√≠ticos</h4>
                            
                            <div class="decision-item">
                                <h5>Verifica√ß√£o de Plano</h5>
                                <pre><code>if (company.plan.ai_agent_enabled) {
  // Mostra bot√£o "Treinar IA"
} else {
  // Esconde bot√£o ou mostra desabilitado
}</code></pre>
                            </div>

                            <div class="decision-item">
                                <h5>Ativa√ß√£o do PEPE</h5>
                                <pre><code>if (ticket.queueId && !ticket.userId && whatsapp.ai_enabled) {
  // PEPE assume o ticket
} else {
  // Fluxo normal para "Aguardando"
}</code></pre>
                            </div>

                            <div class="decision-item">
                                <h5>Busca por Similaridade</h5>
                                <pre><code>if (similarityScore >= 0.7) {
  // Usa contexto encontrado
} else {
  // Transfere para humano
}</code></pre>
                            </div>

                            <div class="decision-item">
                                <h5>Controle de IA</h5>
                                <pre><code>if (aiSession.isPaused) {
  // N√£o processa com IA
} else {
  // PEPE pode processar
}</code></pre>
                            </div>
                        </div>

                        <div class="system-states">
                            <h4>üìä Estados do Sistema</h4>
                            
                            <div class="state-list">
                                <div class="state-item">
                                    <h5>üö´ Sem IA</h5>
                                    <p>Plano n√£o permite ‚Üí Fluxo normal sem PEPE</p>
                                </div>
                                
                                <div class="state-item">
                                    <h5>‚öôÔ∏è N√£o Treinado</h5>
                                    <p>IA permitida mas n√£o configurada ‚Üí Bot√£o "Treinar IA"</p>
                                </div>
                                
                                <div class="state-item">
                                    <h5>‚úÖ PEPE Ativo</h5>
                                    <p>IA treinada e funcionando ‚Üí Processa mensagens</p>
                                </div>
                                
                                <div class="state-item">
                                    <h5>‚è∏Ô∏è IA Pausada</h5>
                                    <p>Operador pausou ‚Üí Aguarda reativa√ß√£o</p>
                                </div>
                                
                                <div class="state-item">
                                    <h5>üë§ Atendimento Humano</h5>
                                    <p>Humano assumiu controle ‚Üí PEPE inativo</p>
                                </div>
                            </div>
                        </div>

                        <div class="data-flow">
                            <h4>üîÑ Fluxo de Dados</h4>
                            
                            <div class="flow-sequence">
                                <h5>Sequ√™ncia de Treinamento:</h5>
                                <ol>
                                    <li>Usu√°rio ‚Üí Frontend: Clica "Treinar IA"</li>
                                    <li>Frontend ‚Üí Usu√°rio: Abre modal</li>
                                    <li>Usu√°rio ‚Üí Frontend: Preenche dados</li>
                                    <li>Frontend ‚Üí Backend: POST /ai-training/simple</li>
                                    <li>Backend ‚Üí Database: Salva dados</li>
                                    <li>Backend ‚Üí Database: Gera embeddings</li>
                                    <li>Backend ‚Üí Database: Ativa PEPE</li>
                                    <li>Backend ‚Üí Frontend: Sucesso</li>
                                    <li>Frontend ‚Üí Usu√°rio: "PEPE ativado!"</li>
                                </ol>
                            </div>

                            <div class="flow-sequence">
                                <h5>Sequ√™ncia de Atendimento:</h5>
                                <ol>
                                    <li>WhatsApp ‚Üí Backend: Nova mensagem</li>
                                    <li>Backend ‚Üí Database: Busca ticket</li>
                                    <li>Backend ‚Üí Backend: Chatbot b√°sico</li>
                                    <li>WhatsApp ‚Üí Backend: Cliente escolhe setor</li>
                                    <li>Backend ‚Üí Database: Verifica PEPE ativo</li>
                                    <li>Backend ‚Üí Database: PEPE assume ticket</li>
                                    <li>Backend ‚Üí Database: Busca dados treinamento</li>
                                    <li>Backend ‚Üí Database: Gera embedding pergunta</li>
                                    <li>Backend ‚Üí Database: Busca similaridade</li>
                                    <li>Backend ‚Üí DeepSeek API: Envia prompt</li>
                                    <li>DeepSeek API ‚Üí Backend: Resposta IA</li>
                                    <li>Backend ‚Üí WhatsApp: Envia resposta</li>
                                </ol>
                            </div>
                        </div>

                        <div class="implementation-checklist">
                            <h4>üìã Checklist de Implementa√ß√£o</h4>
                            
                            <div class="checklist-grid">
                                <div class="checklist-section">
                                    <h5>‚úÖ Configura√ß√£o</h5>
                                    <ul>
                                        <li>Par√¢metro ai_agent_enabled nos planos</li>
                                        <li>Usu√°rio PEPE no sistema</li>
                                        <li>Extens√£o pgvector no PostgreSQL</li>
                                    </ul>
                                </div>
                                
                                <div class="checklist-section">
                                    <h5>‚úÖ Treinamento</h5>
                                    <ul>
                                        <li>Modal de treinamento na tela Conex√µes</li>
                                        <li>API de salvamento de dados</li>
                                        <li>Gera√ß√£o de embeddings locais</li>
                                        <li>Ativa√ß√£o autom√°tica do PEPE</li>
                                    </ul>
                                </div>
                                
                                <div class="checklist-section">
                                    <h5>‚úÖ Processamento</h5>
                                    <ul>
                                        <li>Integra√ß√£o com DeepSeek API</li>
                                        <li>Busca por similaridade vetorial</li>
                                        <li>Gera√ß√£o de respostas contextuais</li>
                                        <li>Sistema de fallback para humanos</li>
                                    </ul>
                                </div>
                                
                                <div class="checklist-section">
                                    <h5>‚úÖ Interface</h5>
                                    <ul>
                                        <li>Nova aba "Pepe AI" nos atendimentos</li>
                                        <li>Controles de pausa/retomada</li>
                                        <li>Indicadores visuais de IA ativa</li>
                                        <li>Alertas para interven√ß√£o humana</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="architecture-files">
                            <h4>üóÇÔ∏è Estrutura de Arquivos</h4>
                            
                            <div class="file-structure">
                                <h5>Backend:</h5>
                                <ul>
                                    <li><code>src/services/AIServices/PepeAIService.ts</code></li>
                                    <li><code>src/services/AIServices/EmbeddingService.ts</code></li>
                                    <li><code>src/services/AIServices/DeepSeekService.ts</code></li>
                                    <li><code>src/models/AITrainingSimple.ts</code></li>
                                    <li><code>src/models/AIEmbeddingLocal.ts</code></li>
                                    <li><code>src/controllers/AITrainingController.ts</code></li>
                                    <li><code>src/routes/aiTrainingRoutes.ts</code></li>
                                </ul>
                            </div>

                            <div class="file-structure">
                                <h5>Frontend:</h5>
                                <ul>
                                    <li><code>pages/Connections/TrainingModal.tsx</code></li>
                                    <li><code>pages/Connections/TrainAIButton.tsx</code></li>
                                    <li><code>pages/Tickets/PepeAITab.tsx</code></li>
                                    <li><code>pages/Tickets/AIControlPanel.tsx</code></li>
                                </ul>
                            </div>

                            <div class="file-structure">
                                <h5>Database:</h5>
                                <ul>
                                    <li><code>ai_training_simple</code> - Dados de treinamento</li>
                                    <li><code>ai_embeddings_local</code> - Embeddings vetoriais</li>
                                    <li><code>users</code> - Usu√°rio PEPE</li>
                                    <li><code>plans</code> - Par√¢metro ai_agent_enabled</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="treinamento" class="section">
                <h2>Treinamento do Agente IA</h2>
                <div class="content">
                    <div class="training-overview">
                        <h3>Sistema de Treinamento da IA com Embeddings e Similaridade</h3>
                        <p>O PEPE ser√° treinado usando uma combina√ß√£o de embeddings vetoriais e an√°lise de similaridade para fornecer respostas contextuais e precisas baseadas no conhecimento espec√≠fico de cada empresa.</p>
                    </div>

                    <div class="embedding-system">
                        <h3>Sistema de Embeddings</h3>
                        
                        <div class="embedding-process">
                            <h4>Como Funciona</h4>
                            <div class="process-steps">
                                <div class="step">
                                    <span class="step-number">1</span>
                                    <div class="step-content">
                                        <h5>Coleta de Dados</h5>
                                        <p>Extra√ß√£o de informa√ß√µes da empresa: site, documentos, FAQs, hist√≥rico de conversas</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">2</span>
                                    <div class="step-content">
                                        <h5>Processamento de Texto</h5>
                                        <p>Segmenta√ß√£o em chunks, limpeza e normaliza√ß√£o dos dados</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">3</span>
                                    <div class="step-content">
                                        <h5>Gera√ß√£o de Embeddings</h5>
                                        <p>Convers√£o de texto em vetores usando modelos de embedding</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">4</span>
                                    <div class="step-content">
                                        <h5>Armazenamento Vetorial</h5>
                                        <p>Indexa√ß√£o em banco de dados vetorial para busca r√°pida</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <span class="step-number">5</span>
                                    <div class="step-content">
                                        <h5>Busca por Similaridade</h5>
                                        <p>Recupera√ß√£o de contexto relevante baseado na pergunta do cliente</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="embedding-models">
                            <h4>Modelos de Embedding</h4>
                            <div class="model-grid">
                                <div class="model-card">
                                    <h5>text-embedding-3-small</h5>
                                    <p><strong>Provedor:</strong> OpenAI via OpenRouter</p>
                                    <p><strong>Dimens√µes:</strong> 1536</p>
                                    <p><strong>Custo:</strong> $0.00002/1K tokens</p>
                                    <p><strong>Uso:</strong> Embedding principal para textos gerais</p>
                                </div>
                                <div class="model-card">
                                    <h5>text-embedding-3-large</h5>
                                    <p><strong>Provedor:</strong> OpenAI via OpenRouter</p>
                                    <p><strong>Dimens√µes:</strong> 3072</p>
                                    <p><strong>Custo:</strong> $0.00013/1K tokens</p>
                                    <p><strong>Uso:</strong> Embedding de alta precis√£o para documentos importantes</p>
                                </div>
                                <div class="model-card">
                                    <h5>multilingual-e5-large</h5>
                                    <p><strong>Provedor:</strong> Hugging Face</p>
                                    <p><strong>Dimens√µes:</strong> 1024</p>
                                    <p><strong>Custo:</strong> Gratuito</p>
                                    <p><strong>Uso:</strong> Fallback para textos multil√≠ngues</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="similarity-search">
                        <h3>Sistema de Busca por Similaridade</h3>
                        
                        <div class="similarity-process">
                            <h4>Algoritmo de Similaridade</h4>
                            <div class="algorithm-explanation">
                                <div class="algorithm-step">
                                    <h5>1. Embedding da Pergunta</h5>
                                    <p>Pergunta do cliente √© convertida em vetor usando o mesmo modelo de embedding</p>
                                    <pre><code>const questionEmbedding = await embeddingModel.embed(userQuestion);</code></pre>
                                </div>
                                
                                <div class="algorithm-step">
                                    <h5>2. Busca Vetorial</h5>
                                    <p>Busca por similaridade coseno no banco de dados vetorial</p>
                                    <pre><code>const similarChunks = await vectorDB.search({
  vector: questionEmbedding,
  topK: 5,
  threshold: 0.7
});</code></pre>
                                </div>
                                
                                <div class="algorithm-step">
                                    <h5>3. Ranking e Filtragem</h5>
                                    <p>Ordena√ß√£o por score de similaridade e filtragem por relev√¢ncia</p>
                                    <pre><code>const relevantContext = similarChunks
  .filter(chunk => chunk.score > 0.7)
  .slice(0, 3)
  .map(chunk => chunk.content);</code></pre>
                                </div>
                                
                                <div class="algorithm-step">
                                    <h5>4. Constru√ß√£o do Contexto</h5>
                                    <p>Combina√ß√£o dos chunks mais relevantes para formar o contexto</p>
                                    <pre><code>const context = relevantContext.join('\n\n');
const prompt = buildPrompt(userQuestion, context, companyInfo);</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="similarity-metrics">
                            <h4>M√©tricas de Similaridade</h4>
                            <div class="metrics-explanation">
                                <div class="metric-item">
                                    <h5>Similaridade Coseno</h5>
                                    <p>Medida principal: varia de -1 a 1, onde 1 = id√™ntico</p>
                                    <p><strong>Threshold:</strong> 0.7 (m√≠nimo para considerar relevante)</p>
                                </div>
                                <div class="metric-item">
                                    <h5>Dist√¢ncia Euclidiana</h5>
                                    <p>M√©trica secund√°ria para desempate</p>
                                    <p><strong>Uso:</strong> Quando m√∫ltiplos chunks t√™m score similar</p>
                                </div>
                                <div class="metric-item">
                                    <h5>Score de Relev√¢ncia</h5>
                                    <p>Combina√ß√£o de similaridade + metadados (data, categoria)</p>
                                    <p><strong>Peso:</strong> 70% similaridade + 30% metadados</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="training-data-sources">
                        <h3>Fontes de Dados para Treinamento</h3>
                        
                        <div class="data-sources-grid">
                            <div class="source-item">
                                <h4>üåê Website da Empresa</h4>
                                <ul>
                                    <li>P√°ginas principais (sobre, servi√ßos, produtos)</li>
                                    <li>FAQ e documenta√ß√£o</li>
                                    <li>Pol√≠ticas e termos de uso</li>
                                    <li>Blog posts e artigos</li>
                                </ul>
                                <p><strong>Atualiza√ß√£o:</strong> Semanal autom√°tica</p>
                            </div>
                            
                            <div class="source-item">
                                <h4>üí¨ Hist√≥rico de Conversas</h4>
                                <ul>
                                    <li>Mensagens de tickets resolvidos</li>
                                    <li>Perguntas frequentes identificadas</li>
                                    <li>Respostas bem avaliadas</li>
                                    <li>Padr√µes de linguagem da empresa</li>
                                </ul>
                                <p><strong>Atualiza√ß√£o:</strong> Di√°ria incremental</p>
                            </div>
                            
                            <div class="source-item">
                                <h4>üìÑ Documentos Manuais</h4>
                                <ul>
                                    <li>Manuais de produtos/servi√ßos</li>
                                    <li>Cat√°logos e listas de pre√ßos</li>
                                    <li>Procedimentos internos</li>
                                    <li>Scripts de atendimento</li>
                                </ul>
                                <p><strong>Atualiza√ß√£o:</strong> Manual via upload</p>
                            </div>
                            
                            <div class="source-item">
                                <h4>üéØ Treinamento Customizado</h4>
                                <ul>
                                    <li>Perguntas e respostas espec√≠ficas</li>
                                    <li>Casos de uso particulares</li>
                                    <li>Linguagem e tom da marca</li>
                                    <li>Regras de neg√≥cio espec√≠ficas</li>
                                </ul>
                                <p><strong>Atualiza√ß√£o:</strong> Sob demanda</p>
                            </div>
                        </div>
                    </div>

                    <div class="vector-database">
                        <h3>Banco de Dados Vetorial</h3>
                        
                        <div class="database-options">
                            <h4>Op√ß√µes de Implementa√ß√£o</h4>
                            <div class="db-comparison">
                                <div class="db-option recommended">
                                    <h5>üèÜ Pinecone (Recomendado)</h5>
                                    <div class="pros-cons">
                                        <div class="pros">
                                            <h6>Pr√≥s:</h6>
                                            <ul>
                                                <li>Managed service (sem manuten√ß√£o)</li>
                                                <li>Escalabilidade autom√°tica</li>
                                                <li>Performance otimizada</li>
                                                <li>Integra√ß√£o simples</li>
                                            </ul>
                                        </div>
                                        <div class="cons">
                                            <h6>Contras:</h6>
                                            <ul>
                                                <li>Custo por uso</li>
                                                <li>Depend√™ncia externa</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <p><strong>Custo:</strong> $70/m√™s para 100K vetores</p>
                                </div>
                                
                                <div class="db-option">
                                    <h5>üêò PostgreSQL + pgvector</h5>
                                    <div class="pros-cons">
                                        <div class="pros">
                                            <h6>Pr√≥s:</h6>
                                            <ul>
                                                <li>Integra√ß√£o com banco existente</li>
                                                <li>Sem custos adicionais</li>
                                                <li>Controle total</li>
                                                <li>ACID compliance</li>
                                            </ul>
                                        </div>
                                        <div class="cons">
                                            <h6>Contras:</h6>
                                            <ul>
                                                <li>Performance limitada</li>
                                                <li>Manuten√ß√£o manual</li>
                                                <li>Escalabilidade complexa</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <p><strong>Custo:</strong> Apenas recursos de servidor</p>
                                </div>
                                
                                <div class="db-option">
                                    <h5>üîç Weaviate</h5>
                                    <div class="pros-cons">
                                        <div class="pros">
                                            <h6>Pr√≥s:</h6>
                                            <ul>
                                                <li>Open source</li>
                                                <li>Recursos avan√ßados</li>
                                                <li>M√∫ltiplos tipos de dados</li>
                                                <li>GraphQL API</li>
                                            </ul>
                                        </div>
                                        <div class="cons">
                                            <h6>Contras:</h6>
                                            <ul>
                                                <li>Complexidade de setup</li>
                                                <li>Curva de aprendizado</li>
                                                <li>Recursos de servidor</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <p><strong>Custo:</strong> Self-hosted ou $25/m√™s cloud</p>
                                </div>
                            </div>
                        </div>

                        <div class="database-schema">
                            <h4>Estrutura do Banco Vetorial</h4>
                            <pre><code>-- Tabela para armazenar embeddings
CREATE TABLE ai_embeddings (
  id SERIAL PRIMARY KEY,
  company_id INTEGER REFERENCES companies(id),
  content_type VARCHAR(50), -- 'website', 'conversation', 'document', 'manual'
  content_text TEXT NOT NULL,
  content_summary TEXT,
  embedding VECTOR(1536), -- Para text-embedding-3-small
  metadata JSONB, -- {category, url, date, tags, etc}
  similarity_threshold DECIMAL(3,2) DEFAULT 0.7,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para performance
CREATE INDEX idx_ai_embeddings_company ON ai_embeddings(company_id);
CREATE INDEX idx_ai_embeddings_type ON ai_embeddings(content_type);
CREATE INDEX idx_ai_embeddings_vector ON ai_embeddings USING ivfflat (embedding vector_cosine_ops);

-- Tabela para controle de treinamento
CREATE TABLE ai_training_jobs (
  id SERIAL PRIMARY KEY,
  company_id INTEGER REFERENCES companies(id),
  job_type VARCHAR(50), -- 'website_crawl', 'document_upload', 'conversation_analysis'
  status VARCHAR(20), -- 'pending', 'running', 'completed', 'failed'
  source_url VARCHAR(500),
  processed_chunks INTEGER DEFAULT 0,
  total_chunks INTEGER DEFAULT 0,
  error_message TEXT,
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                        </div>
                    </div>

                    <div class="training-pipeline">
                        <h3>Pipeline de Treinamento</h3>
                        
                        <div class="pipeline-stages">
                            <div class="stage">
                                <h4>Est√°gio 1: Coleta de Dados</h4>
                                <div class="stage-details">
                                    <h5>Extra√ß√£o de Website</h5>
                                    <pre><code>// Servi√ßo de extra√ß√£o de website
class WebsiteExtractionService {
  async extractWebsite(url: string, companyId: number) {
    const crawler = new WebCrawler({
      maxPages: 50,
      respectRobotsTxt: true,
      delay: 1000
    });
    
    const pages = await crawler.crawl(url);
    
    for (const page of pages) {
      const chunks = this.chunkText(page.content, 500);
      await this.processChunks(chunks, companyId, 'website');
    }
  }
}</code></pre>
                                    
                                    <h5>An√°lise de Conversas</h5>
                                    <pre><code>// Extra√ß√£o de padr√µes de conversas
class ConversationAnalysisService {
  async analyzeConversations(companyId: number) {
    const resolvedTickets = await Ticket.findAll({
      where: { companyId, status: 'closed' },
      include: [{ model: Message }]
    });
    
    for (const ticket of resolvedTickets) {
      const conversation = this.extractQAPairs(ticket.messages);
      await this.createEmbeddings(conversation, companyId);
    }
  }
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="stage">
                                <h4>Est√°gio 2: Processamento de Texto</h4>
                                <div class="stage-details">
                                    <h5>Chunking Inteligente</h5>
                                    <pre><code>class TextChunker {
  chunkText(text: string, maxTokens: number = 500): string[] {
    // Divis√£o por par√°grafos primeiro
    const paragraphs = text.split('\n\n');
    const chunks: string[] = [];
    let currentChunk = '';
    
    for (const paragraph of paragraphs) {
      const tokens = this.countTokens(currentChunk + paragraph);
      
      if (tokens > maxTokens && currentChunk) {
        chunks.push(currentChunk.trim());
        currentChunk = paragraph;
      } else {
        currentChunk += (currentChunk ? '\n\n' : '') + paragraph;
      }
    }
    
    if (currentChunk) chunks.push(currentChunk.trim());
    return chunks;
  }
}</code></pre>
                                    
                                    <h5>Limpeza e Normaliza√ß√£o</h5>
                                    <pre><code>class TextCleaner {
  cleanText(text: string): string {
    return text
      .replace(/\s+/g, ' ') // M√∫ltiplos espa√ßos
      .replace(/[^\w\s\.\,\!\?\-]/g, '') // Caracteres especiais
      .trim()
      .toLowerCase();
  }
  
  extractKeywords(text: string): string[] {
    // Extra√ß√£o de palavras-chave relevantes
    const stopWords = ['o', 'a', 'de', 'para', 'com', 'em'];
    return text.split(' ')
      .filter(word => !stopWords.includes(word))
      .filter(word => word.length > 3);
  }
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="stage">
                                <h4>Est√°gio 3: Gera√ß√£o de Embeddings</h4>
                                <div class="stage-details">
                                    <h5>Servi√ßo de Embedding</h5>
                                    <pre><code>class EmbeddingService {
  async generateEmbedding(text: string): Promise<number[]> {
    const response = await openRouterClient.embeddings.create({
      model: 'text-embedding-3-small',
      input: text
    });
    
    return response.data[0].embedding;
  }
  
  async batchEmbeddings(texts: string[]): Promise<number[][]> {
    // Processamento em lotes para efici√™ncia
    const batches = this.chunkArray(texts, 100);
    const allEmbeddings: number[][] = [];
    
    for (const batch of batches) {
      const embeddings = await this.generateEmbedding(batch.join(' '));
      allEmbeddings.push(...embeddings);
    }
    
    return allEmbeddings;
  }
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="stage">
                                <h4>Est√°gio 4: Indexa√ß√£o e Armazenamento</h4>
                                <div class="stage-details">
                                    <h5>Armazenamento no Banco Vetorial</h5>
                                    <pre><code>class VectorStorageService {
  async storeEmbedding(data: {
    companyId: number;
    contentType: string;
    text: string;
    embedding: number[];
    metadata: any;
  }) {
    await AIEmbedding.create({
      company_id: data.companyId,
      content_type: data.contentType,
      content_text: data.text,
      content_summary: this.generateSummary(data.text),
      embedding: data.embedding,
      metadata: data.metadata
    });
  }
  
  async searchSimilar(
    queryEmbedding: number[], 
    companyId: number, 
    limit: number = 5
  ) {
    return await AIEmbedding.findAll({
      where: { company_id: companyId },
      order: [
        [sequelize.fn('cosine_distance', 
          sequelize.col('embedding'), 
          queryEmbedding
        ), 'ASC']
      ],
      limit
    });
  }
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="training-interface">
                        <h3>Interface de Treinamento</h3>
                        
                        <div class="interface-mockup">
                            <h4>Painel de Treinamento do PEPE</h4>
                            <div class="training-sections">
                                <div class="training-section">
                                    <h5>üìä Status do Treinamento</h5>
                                    <ul>
                                        <li>Total de chunks processados: 1,247</li>
                                        <li>√öltima atualiza√ß√£o: 2 horas atr√°s</li>
                                        <li>Qualidade do embedding: 94%</li>
                                        <li>Cobertura de t√≥picos: 87%</li>
                                    </ul>
                                </div>
                                
                                <div class="training-section">
                                    <h5>üåê Fontes de Dados</h5>
                                    <ul>
                                        <li>Website: ‚úÖ 45 p√°ginas processadas</li>
                                        <li>Conversas: ‚úÖ 892 tickets analisados</li>
                                        <li>Documentos: ‚è≥ 3 arquivos pendentes</li>
                                        <li>FAQ Manual: ‚úÖ 67 pares Q&A</li>
                                    </ul>
                                </div>
                                
                                <div class="training-section">
                                    <h5>üéØ Teste de Qualidade</h5>
                                    <div class="quality-test">
                                        <input type="text" placeholder="Digite uma pergunta para testar..." />
                                        <button>Testar Similaridade</button>
                                        <div class="test-results">
                                            <p><strong>Chunks encontrados:</strong> 3</p>
                                            <p><strong>Melhor score:</strong> 0.89</p>
                                            <p><strong>Contexto relevante:</strong> Sim</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="training-section">
                                    <h5>‚öôÔ∏è Configura√ß√µes Avan√ßadas</h5>
                                    <ul>
                                        <li>Threshold de similaridade: 0.7</li>
                                        <li>Tamanho do chunk: 500 tokens</li>
                                        <li>Overlap entre chunks: 50 tokens</li>
                                        <li>Modelo de embedding: text-embedding-3-small</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="training-costs">
                        <h3>Custos de Treinamento</h3>
                        
                        <div class="cost-breakdown">
                            <div class="cost-item">
                                <h4>üí∞ Embedding Generation</h4>
                                <p><strong>Modelo:</strong> text-embedding-3-small</p>
                                <p><strong>Custo:</strong> $0.00002 por 1K tokens</p>
                                <p><strong>Estimativa:</strong> ~$2-5 por empresa (setup inicial)</p>
                            </div>
                            
                            <div class="cost-item">
                                <h4>üóÑÔ∏è Vector Storage</h4>
                                <p><strong>Pinecone:</strong> $70/m√™s para 100K vetores</p>
                                <p><strong>PostgreSQL:</strong> Inclu√≠do no servidor</p>
                                <p><strong>Estimativa:</strong> $0.70 por empresa/m√™s (Pinecone)</p>
                            </div>
                            
                            <div class="cost-item">
                                <h4>üîÑ Atualiza√ß√µes</h4>
                                <p><strong>Website crawling:</strong> Semanal</p>
                                <p><strong>Conversation analysis:</strong> Di√°rio</p>
                                <p><strong>Estimativa:</strong> $1-3 por empresa/m√™s</p>
                            </div>
                            
                            <div class="cost-total">
                                <h4>üìä Total Estimado</h4>
                                <p><strong>Setup inicial:</strong> $2-5 por empresa</p>
                                <p><strong>Custo mensal:</strong> $2-6 por empresa</p>
                                <p><strong>ROI esperado:</strong> 300-500% (redu√ß√£o de atendimento manual)</p>
                            </div>
                        </div>
                    </div>

                    <div class="training-types">
                        <h3>Tipos de Treinamento por Plano</h3>
                        
                        <div class="training-plans">
                            <div class="plan-item">
                                <h4>Treinamento B√°sico (Todos os Planos com IA)</h4>
                                <ul>
                                    <li>Informa√ß√µes b√°sicas da empresa</li>
                                    <li>10 perguntas e respostas personalizadas</li>
                                    <li>Configura√ß√µes simples de transfer√™ncia</li>
                                </ul>
                            </div>
                            
                            <div class="plan-item">
                                <h4>Treinamento Avan√ßado (Planos Premium)</h4>
                                <ul>
                                    <li>At√© 50 perguntas e respostas personalizadas</li>
                                    <li>Upload de documentos (cat√°logos, manuais)</li>
                                    <li>Integra√ß√£o com sistemas externos (estoque, pre√ßos)</li>
                                    <li>Analytics de performance da IA</li>
                                </ul>
                            </div>
                            
                            <div class="plan-item">
                                <h4>Treinamento Enterprise</h4>
                                <ul>
                                    <li>Treinamento ilimitado</li>
                                    <li>IA dedicada por empresa</li>
                                    <li>Suporte t√©cnico especializado</li>
                                    <li>Customiza√ß√µes espec√≠ficas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="config" class="section">
                <h2>Configura√ß√£o</h2>
                <div class="content">
                    <h3>Vari√°veis de Ambiente</h3>
                    <p><strong>Arquivo:</strong> <code>.env</code></p>
                    <pre><code># Database
DB_DIALECT=mysql
DB_HOST=localhost
DB_PORT=3306
DB_NAME=smartatendimento
DB_USER=root
DB_PASS=

# Redis
IO_REDIS_SERVER=localhost
IO_REDIS_PORT=6379

# JWT
JWT_SECRET=your-secret-key
JWT_REFRESH_SECRET=your-refresh-secret

# WhatsApp
CHROME_ARGS=--no-sandbox</code></pre>

                    <h3>Scripts Principais</h3>
                    <ul>
                        <li><code>npm run dev</code> - Desenvolvimento</li>
                        <li><code>npm run build</code> - Build para produ√ß√£o</li>
                        <li><code>npm start</code> - Iniciar produ√ß√£o</li>
                        <li><code>npm run db:migrate</code> - Executar migrations</li>
                        <li><code>npm run db:seed</code> - Executar seeders</li>
                    </ul>

                    <h3>Configura√ß√£o de Banco de Dados</h3>
                    <p><strong>Banco de dados:</strong> PostgreSQL</p>
                    <pre><code>DB_DIALECT=postgres
DB_HOST=localhost
DB_USER=postgres
DB_NAME=smart_atendimento_db
DB_PORT=5432</code></pre>

                    <h3>Configura√ß√µes Importantes</h3>
                    <ul>
                        <li><strong>Database:</strong> <code>src/database/index.ts</code></li>
                        <li><strong>Server:</strong> <code>src/server.ts</code></li>
                        <li><strong>App:</strong> <code>src/app.ts</code></li>
                        <li><strong>Socket:</strong> <code>src/libs/socket.ts</code></li>
                    </ul>
                </div>
            </section>
            </main>
        </div>
    </div>

    <!-- Modal -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Documento</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <p>Carregando...</p>
            </div>
        </div>
    </div>

    <script src="backend-script.js"></script>
</body>
</html>